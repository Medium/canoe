<!DOCTYPE html>

<html>
<head>
  <title>index.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="index.html">
                index.js
              </a>
            
              
              <a class="source" href="Queue.html">
                Queue.js
              </a>
            
              
              <a class="source" href="Stream.html">
                Stream.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>index.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>Copyright 2013 The Obvious Corporation.</p>
<h2>S3 Utils</h2>
<p>Arguments:</p>
<ul>
<li><code>s3</code>: Authenticated <code>AWS.S3</code> instance</li>
</ul>
<p>Usage:</p>
<pre><code>var AWS = require(&#39;aws-sdk&#39;);
var s3 = new AWS.S3(configParams);
var s3Utils = new S3Utils(s3);</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">var</span> S3Utils = module.exports = <span class="keyword">function</span>(s3) {
  <span class="keyword">this</span>.s3 = s3;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h2>Load S3Stream</h2>
<p>Loads the base S3Stream class, which extends <code>stream.Writable</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="keyword">var</span> S3Stream = require(<span class="string">'./lib/Stream'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h2>CreateWriteStream</h2>
<p>Usage:</p>
<pre><code>var s3stream = s3Utils.createWriteStream({
  Bucket: &#39;random-access-memories&#39;,
  Key: &#39;to-get-lucky.log&#39;
});;
fs.createReadStream(&#39;./for-good-fun.log&#39;).pipe(s3stream);</code></pre>
<ul>
<li><code>params</code>: same params object as <code>AWS.S3.createMultipartUpload()</code></li>
<li><code>callback</code>: Optional, called with <code>(err, writeableStream)</code></li>
</ul>
<p>A writeable stream will be immediately returned, but the stream will not
be ready yet. An upload ID must be retrieved from S3 before the stream
will be ready. You can handle this in a few ways:</p>
<ul>
<li>Wait for the stream to emit a <code>writable</code> event</li>
<li>Provide a callback, which will be called with <code>(err, writeableStream)</code>
when the stream is ready</li>
<li>Start writing immediately and respect <code>false</code> return values. This is how
Node&#39;s <code>stream.pipe()</code> behaves</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>S3Utils.prototype.createWriteStream = <span class="keyword">function</span>(params, callback) {
  <span class="keyword">var</span> s3stream = <span class="keyword">new</span> S3Stream(params, <span class="keyword">this</span>.s3);

  <span class="keyword">this</span>.s3.createMultipartUpload(params, <span class="keyword">function</span>(err, data) {</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Default callback to a noop</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    callback = callback || <span class="keyword">function</span>(){};</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Pass errors to the callback and emit them from the stream</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (err) {
      s3stream.emit(<span class="string">'error'</span>, err);
      <span class="keyword">return</span> callback(err);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Set the <code>UploadId</code> from S3</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    s3stream.params.UploadId = data.UploadId;</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Run the callback</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    callback(<span class="literal">null</span>, s3stream);</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Fire the &#39;writable&#39; event after the callback, in case the callback is
mistakenly waiting for the event.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    s3stream.emit(<span class="string">'writable'</span>);
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Return the write stream</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">return</span> s3stream;
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
